## 1. Вопросы для разогрева

1. Расскажите, с какими задачами в направлении безопасной разработки вы сталкивались?
1) Создание читов для разных игр. В основном для counter strike. 
2) Поиск уязвимостей игры с помощью scantime анализа. 
2. Если вам приходилось проводить security code review или моделирование угроз, расскажите, как это было? 
Моделировать угрозы мне не приходилось.
3. Если у вас был опыт поиска уязвимостей, расскажите, как это было?
Все ПО я писал на Python.
Я искал уязвимости с помощью дебаггера IDA. Реверсил игровые классы с помощью Cheat Engine.
В процессе изучения был интересный случай, когда я пробовал написать ПО для игры. Обычно для вызова меню чита используются клавиши insert, delete или home, и разработчик игры привязал к этим клавишам аварийное закрытие программы. Я долго не мог понять почему при вызове меню чита игра крашится, но в итоге переназначение клавиши вызова меню чита помогло решить проблему.
4. Почему вы хотите участвовать в стажировке?
Улучшить знания в сфере защиты приложений и попробовать себя в направлении AppSec.
---

## 2. Security code review

### Часть 1. Security code review: GO

Требуется провести анализ кода на GO с точки зрения безопасности и подготовить отчет по следующим пунктам:
 - Какие уязвимости присутствуют в этом фрагменте кода?
 - Указать строки, в которых присутствуют уязвимости.
 - К каким последствиям может привести эксплуатация найденных уязвимостей злоумышленником?
 - Описать способы исправления уязвимостей.
 - Если уязвимость можно исправить несколькими способами, необходимо перечислить их, выбрать лучший по вашему мнению и аргументировать свой выбор.

```
package main

import (
    "database/sql"
    "fmt"
    "log"
    "net/http"
    "github.com/go-sql-driver/mysql"
)

var db *sql.DB
var err error

func initDB() {
    db, err = sql.Open("mysql", "user:password@/dbname")
    if err != nil {
        log.Fatal(err)
    }

err = db.Ping()
if err != nil {
    log.Fatal(err)
    }
}

func searchHandler(w http.ResponseWriter, r *http.Request) {
    if r.Method != "GET" {
        http.Error(w, "Method is not supported.", http.StatusNotFound)
        return
    }

searchQuery := r.URL.Query().Get("query")
if searchQuery == "" {
    http.Error(w, "Query parameter is missing", http.StatusBadRequest)
    return
}

query := fmt.Sprintf("SELECT * FROM products WHERE name LIKE '%%%s%%'", searchQuery)
rows, err := db.Query(query)
if err != nil {
    http.Error(w, "Query failed", http.StatusInternalServerError)
    log.Println(err)
    return
}
defer rows.Close()

var products []string
for rows.Next() {
    var name string
    err := rows.Scan(&name)
    if err != nil {
        log.Fatal(err)
    }
    products = append(products, name)
}

fmt.Fprintf(w, "Found products: %v\n", products)
}

func main() {
    initDB()
    defer db.Close()

http.HandleFunc("/search", searchHandler)
fmt.Println("Server is running")
log.Fatal(http.ListenAndServe(":8080", nil))
}
```
**Пример №1 Решение**
Уязвимости в коде:
 - Использование пользовательского ввода в SQL запросе без предварительной обработки.

Строки с уязвимостями:
Строка 37:
```
query := fmt.Sprintf("SELECT * FROM products WHERE name LIKE '%%%s%%'", searchQuery)
```

Последствия эксплуатации уязвимостей:
 - Злоумышленник может выполнить SQL-инъекцию, изменяя параметры запроса и получая несанкционированный доступ к базе данных. Это может привести к утечке конфиденциальной информации, нарушению целостности данных.

Способ исправления уязвимостей:
 - Использовать параметризованные запросы для SQL запросов, чтобы предотвратить возможность SQL-инъекций.


### Часть 2: Security code review: Python

Требуется определить тип уязвимости в примерах кода на Python и ответить на следующие вопросы:
 - Указать строки, в которых присутствуют уязвимости.
 - К каким последствиям может привести эксплуатация данных уязвимостей злоумышленником?
 - Описать способы исправления уязвимостей.
 - Если уязвимость можно исправить несколькими способами, необходимо перечислить их, выбрать лучший по вашему мнению и аргументировать свой выбор.

**Пример №2.1**
```
from flask import Flask, request
from jinja2 import Template

app = Flask(name)

@app.route("/page")
def page():
    name = request.values.get('name')
    age = request.values.get('age', 'unknown')
    output = Template('Hello ' + name + '! Your age is ' + age + '.').render()
return output

if name == "main":
    app.run(debug=True)
```
**Пример №2.1 Решение**
Уязвимости в коде:
 - Использование небезопасного конкатенации строк для формирования HTML-страницы. Это может привести к XSS (межсайтовому скриптингу).

Строки с уязвимостями:
Строка 10: 
```
output = Template('Hello ' + name + '! Your age is ' + age + '.').render()
```

Последствия эксплуатации уязвимостей:
 - Злоумышленник может внедрить вредоносный JavaScript код или другие опасные сценарии в страницу, которая будет выполнена на компьютере пользователя, посетившего эту страницу. Это может привести например к краже cookie пользователей и другим атакам.

Способы исправления уязвимостей:
 - 1) Использовать безопасные методы форматирования строк, такие как шаблоны или строковый метод format().
 - 2) Экранировать специальные символы HTML в пользовательском вводе перед выводом на страницу.

Выбор лучшего способа исправления:
 - Лучшим способом исправления уязвимости является использование безопасных методов форматирования строк с экранированием HTML символов в пользовательском вводе. Это предотвратит возможность выполнения вредоносного кода на стороне клиента и обеспечит безопасность приложения.

Исправление:
```
def page():
    name = escape(request.values.get('name'))
    age = escape(request.values.get('age', 'unknown'))
    output = 'Hello {}! Your age is {}.'.format(name, age)
    return output
```
В этом исправлении мы использовали метод escape() для экранирования специальных символов HTML в пользовательском вводе. Также мы заменили конкатенацию строк на безопасный метод форматирования строк format(), что устраняет уязвимость XSS.

**Пример №2.2**
```
from flask import Flask, request
import subprocess

app = Flask(name)

@app.route("/dns")
def dns_lookup():
    hostname = request.values.get('hostname')
    cmd = 'nslookup ' + hostname
    output = subprocess.check_output(cmd, shell=True, text=True)
return output
if name == "main":
    app.run(debug=True)
```
**Пример №2.2 Решение**
Уязвимости в коде:
 - Использование небезопасного выполнения системных команд через модуль subprocess. Это может привести к выполнению произвольных команд на сервере.

Строки с уязвимостями:
Строка 10: 
```
output = subprocess.check_output(cmd, shell=True, text=True)
```

Последствия эксплойтации уязвимостей:
 - Злоумышленник может выполнить произвольные системные команды на сервере, что может привести к полному контролю над сервером, утечке конфиденциальных данных, удалению или изменению файлов.

Способы исправления уязвимостей:
 - Использовать безопасные методы для выполнения системных команд.

Исправление:
```
import socket

@app.route("/dns")
def dns_lookup():
    hostname = request.values.get('hostname')
    try:
        ip_address = socket.gethostbyname(hostname)
        output = f'IP address of {hostname} is {ip_address}'
    except socket.gaierror:
        output = f'Unable to resolve hostname: {hostname}'
    return output
```

## 3. Моделировани угроз

Изучите диаграмму потоков данных (Data Flow Diagram, DFD) сервиса, обеспечивающего отправку информации в Telegram и Slack:

![DFD](https://github.com/appseccloudcamp/test-assignment/blob/main/test-dfd.png)

Краткое описание компонентов сервиса:
 - **User** - авторизованный пользователь системы. Может настраивать отправку уведомлений и загружать изображения для дальнейшего использования при отправке уведомлений;
 - **Microfront** - микрофронт, которые позволяет взаимодействовать с сервисом отправки информации;
 - **Backend application** - набор микросервисов реализующих бизнес-логику приложения и обеспечивающих взаимодействие со всеми внешними сервисами;
 - **Auth** - сервис отвечающий за аутентификацию и авторизацию клиентов сервиса отправки информации;
 - **S3** - объектное хранилище, предназначенное для хранения статического контента сервиса отправки информации;
 - **PostgreSQL** - база данных, предназначенная для хранения пользовательских конфигураций сервиса отправки информации.    

Проанализируйте диаграмму потоков данных приложения и ответьте на следующий вопросы:
 - Расскажите, какие потенциальные проблемы безопасности существуют для данного сервиса?
 - Расскажите, к каким последствиям может привести эксплуатация проблем, найденных вами?
 - Расскажите, какие способы исправления уязвимостей и смягчения рисков вы можете предложить по отмеченным вами проблемам безопасности?
 - Напишите список уточняющих вопросов, которые вы бы задали разработчикам данного сервиса?

Потенциальные проблемы безопасности:
 - Уязвимости в микросервисах
 - Утечка конфиденциальных данных
 - Недостаточная безопасность загружаемых изображений

Последствия эксплуатации проблем:
 - 1 Компрометация конфиденциальных данных пользователей:
 -  - Возможна утечка личной информации, включая учетные данные, адреса электронной почты и другие конфиденциальные данные.
 - 2 Потеря доступа к системе:
 -  - Атака на микросервисы или базу данных может привести к отказу в обслуживании или недоступности системы для пользователей.
 - 3 Утеря или модификация данных:
 -  - Несанкционированный доступ к PostgreSQL и S3 может привести к утере или изменению пользовательских данных.

Способы исправления и смягчения рисков:
 - 1 Усиление безопасности микросервисов:
 -  - Регулярное обновление и аудит кода микросервисов для обнаружения и исправления уязвимостей, использование инструментов для сканирования уязвимостей.
 - 2 Шифрование данных:
 -  - Шифрование данных, хранящихся в PostgreSQL и S3, для предотвращения утечки конфиденциальной информации в случае несанкционированного доступа.
 - 3 Внедрение механизмов проверки загружаемых изображений:
 -  - Использование антивирусного сканирования или механизмов проверки целостности файлов при загрузке изображений для предотвращения загрузки вредоносных файлов.

Уточняющие вопросы для разработчиков:
 - Какие механизмы аутентификации и авторизации используются для доступа к микросервисам и как они реализованы?
 - Какие меры безопасности приняты для защиты данных в PostgreSQL и S3?
 - Как обеспечивается безопасность загружаемых изображений и какие проверки проходят загружаемые файлы перед их использованием?